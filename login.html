<!DOCTYPE html>
<html>
<head>
  <title>Zyppayx Login / Signup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      font-family:Arial;
      background:#000; /* Dark background */
      margin:0;
      padding:0;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      color:#eee; /* Light text */
    }
    .container{
      background:#111; /* Dark box */
      padding:30px;
      border-radius:12px;
      width:90%;
      max-width:400px;
      box-shadow:0 2px 10px rgba(255,255,255,0.1);
    }
    h2{text-align:center;color:#bb86fc;} /* Purple heading */
    input{
      width:100%;
      padding:10px;
      margin:10px 0;
      border-radius:8px;
      border:1px solid #555;
      background:#222; /* Dark input */
      color:#eee; /* Light text */
    }
    button{
      width:100%;
      padding:10px;
      background:#6a0dad; /* Purple button */
      color:#fff;
      border:none;
      border-radius:8px;
      cursor:pointer;
      margin-top:10px;
    }
    button:hover{
      background:#580c9e; /* Darker purple on hover */
    }
    .toggle{
      color:#bb86fc; /* Purple toggle text */
      text-align:center;
      margin-top:12px;
      cursor:pointer;
    }
    .tnc{
      font-size:12px;
      text-align:center;
      margin-top:10px;
      color:#ccc; /* Light gray text */
    }
    .tnc a{color:#bb86fc;text-decoration:none;} /* Purple links */
  </style>
</head>

<body>

<div class="container">
  <h2 id="title">Login</h2>

  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">

  <button id="submitBtn">Login</button>
  <button id="googleBtn">Sign in with Google</button>

  <p class="tnc">
    By continuing you agree to our
    <a href="terms.html" target="_blank">Terms</a> &
    <a href="privacy.html" target="_blank">Privacy Policy</a>
  </p>

  <p class="toggle" id="toggle">Don't have an account? Signup</p>
</div>

<!-- Firebase SDKs (COMPAT ONLY) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDaQrSeEcCIVOtQJwiEeS_86w11Hn-ITh8",
  authDomain: "zyppayx-57fbf.firebaseapp.com",
  projectId: "zyppayx-57fbf",
  storageBucket: "zyppayx-57fbf.appspot.com",
  messagingSenderId: "79547716710",
  appId: "1:79547716710:web:17287b4e064488020349a7"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* Redirect logged-in users */
auth.onAuthStateChanged(user=>{
  if(user) location.href = "/dashboard.html";
});

let isLogin = true;

const email = document.getElementById("email");
const password = document.getElementById("password");
const submitBtn = document.getElementById("submitBtn");
const toggle = document.getElementById("toggle");
const title = document.getElementById("title");

/* Get referral ID */
function getReferral(){
  return new URLSearchParams(window.location.search).get("ref");
}

/* Toggle login/signup */
toggle.onclick = ()=>{
  isLogin = !isLogin;
  title.innerText = isLogin ? "Login" : "Signup";
  submitBtn.innerText = isLogin ? "Login" : "Signup";
  toggle.innerText = isLogin
    ? "Don't have an account? Signup"
    : "Already have an account? Login";
};

/* Email login/signup */
submitBtn.onclick = async ()=>{
  if(!email.value || !password.value)
    return alert("Fill all fields");

  try{
    let cred;
    if(isLogin){
      cred = await auth.signInWithEmailAndPassword(email.value, password.value);
    }else{
      cred = await auth.createUserWithEmailAndPassword(email.value, password.value);
      await db.collection("users").doc(cred.user.uid).set({
        balance: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        referrerId: getReferral() || null
      });
    }
    location.href = "/dashboard.html";
  }catch(err){
    alert(err.message);
  }
};

/* Google login */
document.getElementById("googleBtn").onclick = async ()=>{
  try{
    const provider = new firebase.auth.GoogleAuthProvider();
    const res = await auth.signInWithPopup(provider);

    const ref = await db.collection("users").doc(res.user.uid).get();
    if(!ref.exists){
      await db.collection("users").doc(res.user.uid).set({
        balance: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        referrerId: getReferral() || null
      });
    }
    location.href = "/dashboard.html";
  }catch(err){
    alert(err.message);
  }
};
</script>

</body>
</html>