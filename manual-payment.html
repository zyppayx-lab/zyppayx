<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manual Payment</title>

<style>
body{font-family:Arial;background:#f6f8fb;padding:20px}
.card{
  background:#fff;
  padding:20px;
  border-radius:14px;
  max-width:420px;
  margin:auto;
  box-shadow:0 4px 12px rgba(0,0,0,.08)
}
.card p{margin:10px 0}
.copy-btn{
  margin-left:8px;
  background:#00c896;
  color:#fff;
  border:none;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
  cursor:pointer
}
.submit-btn{
  margin-top:18px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#0a1f44;
  color:#fff;
  font-weight:bold;
  cursor:pointer
}
</style>
</head>
<body>

<div class="card">
  <h3 id="planTitle">Loading...</h3>

  <p>ROI: <b><span id="roi"></span>%</b></p>
  <p>Duration: <b><span id="duration"></span> days</b></p>

  <hr>

  <p>Bank Name:<br><b>Paystack-Titan</b></p>
  <p>
    Account Number:<br>
    <b id="accNo">9740116304</b>
    <button class="copy-btn" onclick="copy('9740116304')">Copy</button>
  </p>
  <p>Account Name:<br><b>MOREINFOPAY / Zyppayx</b></p>
  <p>
    Amount to Pay:<br>
    â‚¦<b id="amountText"></b>
    <button class="copy-btn" onclick="copy(amount)">Copy</button>
  </p>

  <button class="submit-btn" id="paidBtn">I Have Paid</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  doc,
  getDoc,
  addDoc,
  collection,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain: "zyppayx-69c54.firebaseapp.com",
  projectId: "zyppayx-69c54"
});

const auth = getAuth(app);
const db = getFirestore(app);

const params = new URLSearchParams(location.search);
const planId = params.get("planId");
const amount = Number(params.get("amount"));

document.getElementById("amountText").textContent = amount;

async function loadPlan() {
  const snap = await getDoc(doc(db, "investmentPlans", planId));
  if (!snap.exists()) {
    alert("Invalid investment plan");
    return;
  }
  const p = snap.data();
  document.getElementById("planTitle").textContent = p.title;
  document.getElementById("roi").textContent = p.roiPercent;
  document.getElementById("duration").textContent = p.duration;
}

loadPlan();

onAuthStateChanged(auth, user => {
  if (!user) location.href = "login.html";

  document.getElementById("paidBtn").onclick = async () => {
    await addDoc(collection(db, "investments"), {
      userId: user.uid,
      userEmail: user.email,
      planId,
      amount,
      status: "pending",
      createdAt: serverTimestamp()
    });

    alert("Payment submitted. Awaiting admin approval.");
    location.href = "invest.html";
  };
});

window.copy = t => navigator.clipboard.writeText(t);
</script>
</body>
</html>
