<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Manual Payment</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial;background:#f6f8fb}
.card{background:#fff;margin:20px;padding:18px;border-radius:16px}
.copy{color:#00c896;cursor:pointer}
button{width:100%;padding:12px;border:none;border-radius:10px;background:#00c896;color:#fff;margin-top:10px}
</style>
</head>
<body>

<div class="card">
  <p><b>Bank Name</b><br>Paystack-Titan</p>
  <p><b>Account Number</b><br>
  <span id="acc">9740116304</span> <span class="copy" onclick="copy('acc')">Copy</span></p>
  <p><b>Account Name</b><br>MOREINFOPAY/Zyppayx</p>
  <p><b>Amount</b><br>
  â‚¦<span id="amt"></span> <span class="copy" onclick="copy('amt')">Copy</span></p>
</div>

<button id="submit">I Have Paid</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey:"AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain:"zyppayx-69c54.firebaseapp.com",
  projectId:"zyppayx-69c54"
});
const auth = getAuth(app);
const db = getFirestore(app);

/* ======== Reset local storage if no new plan ===== */
if(!localStorage.getItem("inv_plan")){
  localStorage.removeItem("inv_plan");
  localStorage.removeItem("inv_title");
  localStorage.removeItem("inv_amount");
  localStorage.removeItem("inv_roi");
  localStorage.removeItem("inv_profit");
  localStorage.removeItem("inv_total");
  localStorage.removeItem("inv_duration");
}

/* ======== Display amount ===== */
const amtSpan = document.getElementById("amt");
amtSpan.innerText = localStorage.getItem("inv_amount") || "0";

/* ======== Copy to clipboard ===== */
window.copy = id=>{
  navigator.clipboard.writeText(
    document.getElementById(id).innerText
  ).then(()=> alert("Copied!"));
};

/* ======== Handle submission ===== */
onAuthStateChanged(auth, user=>{
  if(!user) return;

  document.getElementById("submit").onclick = async ()=>{
    const planId = localStorage.getItem("inv_plan");
    const title = localStorage.getItem("inv_title");
    const amount = Number(localStorage.getItem("inv_amount"));
    const roiPercent = Number(localStorage.getItem("inv_roi"));
    const profit = Number(localStorage.getItem("inv_profit"));
    const totalReturn = Number(localStorage.getItem("inv_total"));
    const duration = Number(localStorage.getItem("inv_duration"));

    if(!planId || !amount){
      alert("Something went wrong. Please go back and select a plan.");
      return;
    }

    await addDoc(collection(db,"users",user.uid,"investments"),{
      planId,
      planTitle: title,
      amount,
      roiPercent,
      profit,
      totalReturn,
      duration,
      status: "pending",
      createdAt: Date.now(),
      paymentMethod: "bank-transfer"
    });

    alert("Investment submitted for approval!");

    /* ======== Reset localStorage for next plan ===== */
    localStorage.removeItem("inv_plan");
    localStorage.removeItem("inv_title");
    localStorage.removeItem("inv_amount");
    localStorage.removeItem("inv_roi");
    localStorage.removeItem("inv_profit");
    localStorage.removeItem("inv_total");
    localStorage.removeItem("inv_duration");

    /* ======== Redirect back to invest page ===== */
    window.location.href="invest.html";
  };
});
</script>
</body>
</html>
