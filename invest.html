<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Investments</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f6f8fb;margin:0}
.card{background:#fff;margin:15px;padding:16px;border-radius:14px}
.lock{color:#e74c3c;font-weight:bold}
.ready{color:#00c896;font-weight:bold}
</style>
</head>
<body>

<h3 style="text-align:center">Active Investments</h3>
<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain: "zyppayx-69c54.firebaseapp.com",
  projectId: "zyppayx-69c54"
});

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user => {
  if (!user) return;

  const q = query(
    collection(db, "investments"),
    where("userId", "==", user.uid),
    where("status", "==", "approved")
  );

  const snap = await getDocs(q);
  const box = document.getElementById("list");
  box.innerHTML = "";

  for (const d of snap.docs) {
    const inv = d.data();
    const planSnap = await getDoc(doc(db, "investmentPlans", inv.planId));
    if (!planSnap.exists()) continue;

    const p = planSnap.data();
    const start = inv.startDate?.toMillis();
    const end = inv.endDate?.toMillis();

    const card = document.createElement("div");
    card.className = "card";

    const timer = document.createElement("p");

    function update() {
      const diff = end - Date.now();
      if (diff <= 0) {
        timer.innerHTML = "<span class='ready'>Matured</span>";
      } else {
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        timer.innerHTML = `<span class="lock">Locked:</span> ${d}d ${h}h ${m}m`;
      }
    }

    setInterval(update, 1000);
    update();

    card.innerHTML = `
      <h4>${p.title}</h4>
      <p>Amount: â‚¦${inv.amount}</p>
      <p>ROI: ${p.roiPercent}%</p>
      <p>Duration: ${p.duration} days</p>
    `;
    card.appendChild(timer);
    box.appendChild(card);
  }
});
</script>
</body>
</html>
