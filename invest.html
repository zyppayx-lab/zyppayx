<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zyppayxvest | Invest</title>

<style>
body {
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f6f8fb;
}

header {
  background:#0a1f44;
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:20px;
}

.container {
  max-width:1100px;
  margin:auto;
  padding:15px;
  padding-bottom:90px;
}

.card {
  background:#fff;
  padding:18px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.card h3 {
  margin:0 0 10px;
  font-size:16px;
  color:#0a1f44;
}

.card p {
  margin:4px 0;
  font-size:14px;
  color:#666;
}

.card img {
  width:100%;
  border-radius:12px;
  margin-bottom:10px;
}

.amount-input {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:14px;
}

.quick-amounts {
  display:flex;
  gap:8px;
  margin-top:8px;
}

.quick-amounts button {
  flex:1;
  padding:8px;
  font-size:13px;
  border-radius:6px;
  border:1px solid #00c896;
  background:#ecfdf5;
  color:#047857;
  cursor:pointer;
}

button.main-btn {
  margin-top:12px;
  padding:12px;
  background:#00c896;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  width:100%;
}

button:disabled {
  background:#9ca3af;
  cursor:not-allowed;
}

/* NAV */
nav {
  position:fixed;
  bottom:0;
  width:100%;
  background:#fff;
  border-top:1px solid #ddd;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

nav a {
  text-decoration:none;
  color:#555;
  font-size:13px;
}

nav a.active {
  color:#00c896;
  font-weight:bold;
}

/* LOADER */
.loader {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(10,31,68,.6);
  z-index:9999;
  align-items:center;
  justify-content:center;
}

.loader-card {
  background:#fff;
  padding:30px 25px;
  border-radius:16px;
  text-align:center;
  width:85%;
  max-width:320px;
}

.spinner {
  width:46px;
  height:46px;
  border:5px solid #e5e7eb;
  border-top:5px solid #00c896;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin {
  to { transform:rotate(360deg); }
}

/* SUCCESS */
.success {
  display:none;
  width:60px;
  height:60px;
  margin:auto;
}

.success circle {
  stroke:#00c896;
  stroke-width:3;
  stroke-dasharray:166;
  stroke-dashoffset:166;
  animation:circle .6s forwards;
}

.success path {
  stroke:#00c896;
  stroke-width:4;
  stroke-linecap:round;
  stroke-linejoin:round;
  stroke-dasharray:48;
  stroke-dashoffset:48;
  animation:check .35s .6s forwards;
}

@keyframes circle { to { stroke-dashoffset:0; } }
@keyframes check { to { stroke-dashoffset:0; } }
</style>

<script src="https://js.paystack.co/v1/inline.js"></script>
</head>

<body>

<header>Choose an Investment Plan</header>

<div class="container" id="plansContainer">
  <p>Loading investment plans...</p>
</div>

<nav>
  <a href="dashboard.html">Home</a>
  <a href="invest.html" class="active">Invest</a>
  <a href="refer.html">Refer</a>
  <a href="alert.html">Alerts</a>
  <a href="profile.html">Profile</a>
</nav>

<!-- LOADER -->
<div class="loader" id="loader">
  <div class="loader-card">
    <div class="spinner" id="spinner"></div>
    <div class="success" id="success">
      <svg viewBox="0 0 52 52">
        <circle cx="26" cy="26" r="25" fill="none"/>
        <path fill="none" d="M14 27l7 7 17-17"/>
      </svg>
    </div>
    <p id="loaderText">Processing payment…</p>
    <small id="loaderSub">Please wait</small>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, getDocs, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain: "zyppayx-69c54.firebaseapp.com",
  projectId: "zyppayx-69c54",
  storageBucket: "zyppayx-69c54.firebasestorage.app",
  messagingSenderId: "439535581166",
  appId: "1:439535581166:web:994d1c9f75bd1294ef00ff"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const PAYSTACK_KEY = "pk_live_d52baea87b2c4e49b110aa5cda32260b33b0cb35";

let uid = "", email = "";

onAuthStateChanged(auth, user => {
  if (!user) return location.href = "login.html";
  uid = user.uid;
  email = user.email;
  loadPlans();
});

async function loadPlans() {
  const snap = await getDocs(collection(db, "investmentPlans"));
  const container = document.getElementById("plansContainer");
  container.innerHTML = "";

  snap.forEach(docSnap => {
    const plan = docSnap.data();
    if (plan.status !== "active") return;

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3>${plan.title}</h3>
      <p>Min Amount: ₦${plan.minAmount}</p>

      <input class="amount-input" placeholder="Enter amount" />

      <div class="quick-amounts">
        <button>₦${plan.minAmount}</button>
        <button>₦${plan.minAmount * 2}</button>
        <button>₦${plan.minAmount * 5}</button>
      </div>

      <button class="main-btn">Invest</button>
    `;

    const input = card.querySelector(".amount-input");
    const [b1, b2, b3] = card.querySelectorAll(".quick-amounts button");

    b1.onclick = () => input.value = plan.minAmount;
    b2.onclick = () => input.value = plan.minAmount * 2;
    b3.onclick = () => input.value = plan.minAmount * 5;

    card.querySelector(".main-btn").onclick =
      e => startInvestment(e.target, input, plan, docSnap.id);

    container.appendChild(card);
  });
}

function startInvestment(button, input, plan, planId) {
  const amount = Number(input.value);
  if (!amount || amount < plan.minAmount)
    return alert("Minimum investment is ₦" + plan.minAmount);

  button.disabled = true;
  button.innerText = "Processing…";

  document.getElementById("loader").style.display = "flex";

  PaystackPop.setup({
    key: PAYSTACK_KEY,
    email,
    amount: amount * 100,
    currency: "NGN",
    callback: async res => {
      await addDoc(collection(db, "users", uid, "investments"), {
        planId,
        title: plan.title,
        amount,
        status: "pending",
        paystackReference: res.reference,
        createdAt: serverTimestamp()
      });

      document.getElementById("spinner").style.display = "none";
      document.getElementById("success").style.display = "block";
      document.getElementById("loaderText").innerText = "Investment submitted";

      setTimeout(() => {
        document.getElementById("loader").style.display = "none";
        button.innerText = "Submitted";
      }, 2000);
    },
    onClose: () => {
      document.getElementById("loader").style.display = "none";
      button.disabled = false;
      button.innerText = "Invest";
    }
  }).openIframe();
}
</script>

</body>
    </html>
